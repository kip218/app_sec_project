name: Test
on: [push]
jobs:
  check-bats-version:
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with:
            python-version: '3.x'
      - run: python -m pip install --upgrade pip
      - run: pip install django
      - run: python manage.py makemigrations LegacySite
      - run: python manage.py migrate
      - run: bash import_dbs.sh
      - run: awk '{sub(/stream_or_string = stream_or_string.decode()/,"stream_or_string = stream_or_string.decode('utf-16')")}1' /opt/hostedtoolcache/Python/3.10.4/x64/lib/python3.10/site-packages/django/core/serializers/json.py
      - run: python manage.py test